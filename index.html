
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ponto Telecom - Sistema Avançado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- TensorFlow.js para reconhecimento facial (simulado) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <style>
        :root {
            --primary: #b39ddb;
            --primary-dark: #9575cd;
            --primary-light: #d1c4e9;
            --secondary: #7e57c2;
            --text: #2d3748;
            --background: #f5f3ff;
        }
        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        .header {
            background-color: var(--primary);
            color: white;
        }
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .fc-event {
            cursor: pointer;
        }
        #videoElement {
            width: 320px;
            height: 240px;
            background-color: #666;
        }
        #canvasElement {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <!-- Barra de navegação -->
        <nav class="header p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">Ponto Telecom</h1>
                <div id="auth-buttons" class="space-x-4">
                    <button id="login-btn" class="btn-primary px-4 py-2 rounded">Login</button>
                    <button id="logout-btn" class="hidden px-4 py-2 rounded bg-white text-purple-800">Logout</button>
                </div>
            </div>
        </nav>

        <!-- Conteúdo principal -->
        <main class="container mx-auto p-4">
            <!-- Página de Login -->
            <div id="login-page" class="max-w-md mx-auto mt-10">
                <div class="card p-6">
                    <h2 class="text-2xl font-bold text-purple-800 mb-6">Login</h2>
                    <form id="login-form">
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Email</label>
                            <input type="email" id="email" class="w-full p-2 border border-purple-300 rounded" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 mb-2">Senha</label>
                            <input type="password" id="password" class="w-full p-2 border border-purple-300 rounded" required>
                        </div>
                        <button type="submit" class="w-full btn-primary py-2 px-4 rounded">Entrar</button>
                    </form>
                </div>
            </div>

            <!-- Dashboard (após login) -->
            <div id="dashboard" class="hidden">
                <div class="flex flex-wrap gap-4 mb-6">
                    <button id="registrar-btn" class="btn-primary px-4 py-2 rounded">Registrar Ponto</button>
                    <button id="calendario-btn" class="btn-primary px-4 py-2 rounded">Calendário</button>
                    <button id="ferias-btn" class="btn-primary px-4 py-2 rounded">Férias</button>
                    <button id="relatorios-btn" class="btn-primary px-4 py-2 rounded">Relatórios</button>
                    <button id="admin-btn" class="btn-primary px-4 py-2 rounded hidden">Admin</button>
                </div>

                <!-- Seção de Registrar Ponto -->
                <div id="registrar-section" class="hidden">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-4">Registrar Ponto</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Método tradicional -->
                            <div>
                                <h3 class="text-lg font-semibold mb-3">Método Tradicional</h3>
                                <div class="mb-4">
                                    <label class="block text-gray-700 mb-2">Tipo de Registro</label>
                                    <select id="tipo-registro" class="w-full p-2 border border-purple-300 rounded">
                                        <option value="entrada">Entrada</option>
                                        <option value="saida">Saída</option>
                                        <option value="intervalo">Intervalo</option>
                                    </select>
                                </div>
                                <div id="location-info" class="mb-4 text-sm text-purple-600">
                                    Obtendo localização...
                                </div>
                                <button id="registrar-ponto-btn" class="w-full btn-primary py-2 px-4 rounded" disabled>
                                    Registrar Ponto
                                </button>
                            </div>
                            
                            <!-- Reconhecimento Facial -->
                            <div>
                                <h3 class="text-lg font-semibold mb-3">Reconhecimento Facial</h3>
                                <div class="mb-2">
                                    <video id="videoElement" autoplay></video>
                                    <canvas id="canvasElement"></canvas>
                                </div>
                                <button id="start-face-recognition" class="btn-primary px-4 py-2 rounded mb-2">
                                    Iniciar Reconhecimento
                                </button>
                                <p id="face-recognition-status" class="text-sm"></p>
                            </div>
                        </div>
                        
                        <div id="registro-status" class="mt-4"></div>
                    </div>
                </div>

                <!-- Seção de Calendário -->
                <div id="calendario-section" class="hidden">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-6">Calendário de Pontos</h2>
                        <div id="calendar"></div>
                    </div>
                    
                    <div class="card p-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-4">Banco de Horas</h2>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-lg"><span id="banco-horas-saldo">0</span> horas</p>
                                <p class="text-sm text-gray-600">Saldo atual</p>
                            </div>
                            <div id="banco-horas-chart" class="w-32 h-32"></div>
                        </div>
                    </div>
                </div>

                <!-- Seção de Férias -->
                <div id="ferias-section" class="hidden">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-6">Solicitar Férias</h2>
                        <form id="ferias-form">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Data de Início</label>
                                    <input type="date" id="ferias-inicio" class="w-full p-2 border border-purple-300 rounded" required>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Data de Término</label>
                                    <input type="date" id="ferias-fim" class="w-full p-2 border border-purple-300 rounded" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Observações</label>
                                <textarea id="ferias-obs" class="w-full p-2 border border-purple-300 rounded" rows="3"></textarea>
                            </div>
                            <button type="submit" class="w-full btn-primary py-2 px-4 rounded">Solicitar Férias</button>
                        </form>
                        <div id="ferias-lista" class="mt-8">
                            <h3 class="text-xl font-bold text-purple-800 mb-4">Minhas Solicitações</h3>
                            <div id="ferias-items" class="space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- Seção de Relatórios -->
                <div id="relatorios-section" class="hidden">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-6">Relatórios</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-gray-700 mb-2">Data Inicial</label>
                                <input type="date" id="relatorio-inicio" class="w-full p-2 border border-purple-300 rounded">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Data Final</label>
                                <input type="date" id="relatorio-fim" class="w-full p-2 border border-purple-300 rounded">
                            </div>
                        </div>
                        <button id="gerar-relatorio-btn" class="btn-primary px-4 py-2 rounded mb-6">
                            Gerar Relatório
                        </button>
                        <div id="relatorio-resultado" class="hidden">
                            <div class="card p-4 mb-4">
                                <h3 class="text-lg font-bold text-purple-800 mb-2">Resumo</h3>
                                <div id="relatorio-resumo"></div>
                                <div class="mt-4">
                                    <canvas id="relatorio-chart" height="200"></canvas>
                                </div>
                            </div>
                            <button id="exportar-pdf-btn" class="btn-primary px-4 py-2 rounded">
                                Exportar para PDF
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Seção Admin (apenas para administradores) -->
                <div id="admin-section" class="hidden">
                    <div class="card p-6 mb-6">
                        <h2 class="text-2xl font-bold text-purple-800 mb-6">Painel Administrativo</h2>
                        
                        <div class="mb-6">
                            <h3 class="text-xl font-semibold mb-4">Registros de Ponto Recentes</h3>
                            <div id="admin-pontos-recentes" class="space-y-2"></div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Solicitações de Férias Pendentes</h3>
                            <div id="admin-ferias-pendentes" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para notificações -->
    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg max-w-md w-full">
            <h3 id="notification-title" class="text-xl font-bold mb-2"></h3>
            <p id="notification-message"></p>
            <button id="notification-close" class="mt-4 btn-primary px-4 py-2 rounded">Fechar</button>
        </div>
    </div>

    <script>
        // =============================================
        // Configurações Iniciais e Constantes
        // =============================================
        const LOCAL_STORAGE_KEY = 'ponto-telecom-data';
        const JWT_SECRET = 'ponto-telecom-secret'; // Em produção, use variáveis de ambiente
        
        // =============================================
        // Modelos de Dados
        // =============================================
        class User {
            constructor(id, email, password, name, role) {
                this.id = id;
                this.email = email;
                this.password = password;
                this.name = name;
                this.role = role;
            }
        }

        class Ponto {
            constructor(id, userId, tipo, data, localizacao, metodo = 'manual') {
                this.id = id;
                this.userId = userId;
                this.tipo = tipo;
                this.data = data;
                this.localizacao = localizacao;
                this.metodo = metodo;
            }
        }

        class Ferias {
            constructor(id, userId, inicio, fim, observacoes, status = 'pendente') {
                this.id = id;
                this.userId = userId;
                this.inicio = inicio;
                this.fim = fim;
                this.observacoes = observacoes;
                this.status = status;
                this.dataSolicitacao = new Date().toISOString();
            }
        }

        // =============================================
        // Banco de Dados Simulado
        // =============================================
        function loadDatabase() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) {
                return JSON.parse(savedData);
            }
            
            // Dados iniciais
            const initialData = {
                users: [
                    new User(1, 'admin@telecom.com', '123456', 'Administrador', 'admin'),
                    new User(2, 'funcionario@telecom.com', '123456', 'Funcionário', 'user')
                ],
                pontos: [],
                ferias: []
            };
            
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(initialData));
            return initialData;
        }

        function saveDatabase(data) {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
        }

        // =============================================
        // Autenticação e JWT (simulado)
        // =============================================
        function generateToken(user) {
            // Em produção, use uma biblioteca JWT real
            const payload = {
                id: user.id,
                email: user.email,
                name: user.name,
                role: user.role,
                exp: Date.now() + 3600000 // Expira em 1 hora
            };
            return btoa(JSON.stringify(payload));
        }

        function verifyToken(token) {
            try {
                const payload = JSON.parse(atob(token));
                if (payload.exp < Date.now()) {
                    return null; // Token expirado
                }
                return payload;
            } catch (e) {
                return null;
            }
        }

        // =============================================
        // Estado da Aplicação
        // =============================================
        let currentUser = null;
        let currentToken = null;
        let database = loadDatabase();
        let faceRecognitionModel = null;

        // =============================================
        // Elementos DOM
        // =============================================
        const loginPage = document.getElementById('login-page');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const loginForm = document.getElementById('login-form');
        const registrarBtn = document.getElementById('registrar-btn');
        const calendarioBtn = document.getElementById('calendario-btn');
        const feriasBtn = document.getElementById('ferias-btn');
        const relatoriosBtn = document.getElementById('relatorios-btn');
        const adminBtn = document.getElementById('admin-btn');
        const registrarSection = document.getElementById('registrar-section');
        const calendarioSection = document.getElementById('calendario-section');
        const feriasSection = document.getElementById('ferias-section');
        const relatoriosSection = document.getElementById('relatorios-section');
        const adminSection = document.getElementById('admin-section');
        const tipoRegistro = document.getElementById('tipo-registro');
        const locationInfo = document.getElementById('location-info');
        const registrarPontoBtn = document.getElementById('registrar-ponto-btn');
        const registroStatus = document.getElementById('registro-status');
        const feriasForm = document.getElementById('ferias-form');
        const feriasItems = document.getElementById('ferias-items');
        const gerarRelatorioBtn = document.getElementById('gerar-relatorio-btn');
        const relatorioResultado = document.getElementById('relatorio-resultado');
        const relatorioResumo = document.getElementById('relatorio-resumo');
        const exportarPdfBtn = document.getElementById('exportar-pdf-btn');
        const bancoHorasSaldo = document.getElementById('banco-horas-saldo');
        const videoElement = document.getElementById('videoElement');
        const canvasElement = document.getElementById('canvasElement');
        const startFaceRecognitionBtn = document.getElementById('start-face-recognition');
        const faceRecognitionStatus = document.getElementById('face-recognition-status');
        const notificationModal = document.getElementById('notification-modal');
        const notificationTitle = document.getElementById('notification-title');
        const notificationMessage = document.getElementById('notification-message');
        const notificationClose = document.getElementById('notification-close');

        // =============================================
        // Funções de Utilidade
        // =============================================
        function showNotification(title, message) {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notificationModal.classList.remove('hidden');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        function calcularDiferencaHoras(inicio, fim) {
            const diffMs = (new Date(fim) - new Date(inicio));
            return diffMs / (1000 * 60 * 60); // Converter para horas
        }

        // =============================================
        // Funções de Navegação
        // =============================================
        function showSection(section) {
            registrarSection.classList.add('hidden');
            calendarioSection.classList.add('hidden');
            feriasSection.classList.add('hidden');
            relatoriosSection.classList.add('hidden');
            adminSection.classList.add('hidden');

            switch (section) {
                case 'registrar':
                    registrarSection.classList.remove('hidden');
                    getLocation();
                    break;
                case 'calendario':
                    calendarioSection.classList.remove('hidden');
                    updateCalendar();
                    updateBancoHoras();
                    break;
                case 'ferias':
                    feriasSection.classList.remove('hidden');
                    loadFerias();
                    break;
                case 'relatorios':
                    relatoriosSection.classList.remove('hidden');
                    break;
                case 'admin':
                    adminSection.classList.remove('hidden');
                    loadAdminData();
                    break;
            }
        }

        // =============================================
        // Funcionalidades de Ponto
        // =============================================
        function getLocation() {
            if (navigator.geolocation) {
                locationInfo.textContent = 'Obtendo localização...';
                registrarPontoBtn.disabled = true;
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        locationInfo.innerHTML = `Localização obtida: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                        registrarPontoBtn.disabled = false;
                    },
                    (error) => {
                        locationInfo.innerHTML = `Erro ao obter localização: ${error.message}`;
                        registrarPontoBtn.disabled = true;
                    },
                    { enableHighAccuracy: true }
                );
            } else {
                locationInfo.textContent = "Geolocalização não suportada pelo navegador";
                registrarPontoBtn.disabled = true;
            }
        }

        function registrarPonto() {
            if (!navigator.geolocation) {
                registroStatus.innerHTML = '<p class="text-red-500">Geolocalização não suportada</p>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const novoPonto = new Ponto(
                        database.pontos.length + 1,
                        currentUser.id,
                        tipoRegistro.value,
                        new Date().toISOString(),
                        {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        }
                    );

                    database.pontos.push(novoPonto);
                    saveDatabase(database);
                    
                    registroStatus.innerHTML = `
                        <p class="text-green-500">Ponto registrado com sucesso!</p>
                        <p class="text-sm">${formatDate(novoPonto.data)}</p>
                        <p class="text-sm">Tipo: ${novoPonto.tipo}</p>
                    `;
                    
                    // Simular notificação via WebSocket
                    setTimeout(() => {
                        showNotification('Ponto Registrado', `Novo ponto registrado: ${novoPonto.tipo}`);
                    }, 1000);
                },
                (error) => {
                    registroStatus.innerHTML = `<p class="text-red-500">Erro ao obter localização: ${error.message}</p>`;
                }
            );
        }

        // =============================================
        // Calendário e Banco de Horas
        // =============================================
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,dayGridWeek'
                },
                events: []
            });
            calendar.render();
        }

        function updateCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (calendarEl._fullCalendar) {
                calendarEl._fullCalendar.destroy();
            }

            const userPontos = database.pontos.filter(p => p.userId === currentUser.id);
            const events = userPontos.map(ponto => ({
                title: ponto.tipo.toUpperCase(),
                start: ponto.data,
                color: ponto.tipo === 'entrada' ? '#7e57c2' : 
                       ponto.tipo === 'saida' ? '#b39ddb' : '#d1c4e9',
                extendedProps: {
                    metodo: ponto.metodo,
                    localizacao: ponto.localizacao
                }
            }));

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,dayGridWeek'
                },
                eventClick: function(info) {
                    const ponto = info.event;
                    showNotification(
                        `Ponto: ${ponto.title}`,
                        `Data: ${ponto.start.toLocaleString()}\nMétodo: ${ponto.extendedProps.metodo}\nLocalização: ${ponto.extendedProps.localizacao.lat.toFixed(4)}, ${ponto.extendedProps.localizacao.lng.toFixed(4)}`
                    );
                },
                events: events
            });
            calendar.render();
        }

        function updateBancoHoras() {
            const userPontos = database.pontos.filter(p => p.userId === currentUser.id);
            let saldo = 0;
            let horasTrabalhadas = 0;
            let horasExtras = 0;
            
            // Ordenar por data
            userPontos.sort((a, b) => new Date(a.data) - new Date(b.data));
            
            // Calcular horas trabalhadas
            for (let i = 0; i < userPontos.length; i++) {
                if (userPontos[i].tipo === 'entrada' && i + 1 < userPontos.length && userPontos[i + 1].tipo === 'saida') {
                    const horas = calcularDiferencaHoras(userPontos[i].data, userPontos[i + 1].data);
                    horasTrabalhadas += horas;
                    
                    // Considerar 8h como jornada normal
                    if (horas > 8) {
                        horasExtras += horas - 8;
                    }
                }
            }
            
            saldo = horasExtras - Math.max(0, (22 * 8) - horasTrabalhadas); // 22 dias úteis
            
            bancoHorasSaldo.textContent = saldo.toFixed(2);
            
            // Atualizar gráfico
            const ctx = document.createElement('canvas');
            document.getElementById('banco-horas-chart').innerHTML = '';
            document.getElementById('banco-horas-chart').appendChild(ctx);
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Horas Normais', 'Horas Extras', 'Saldo'],
                    datasets: [{
                        data: [horasTrabalhadas - horasExtras, horasExtras, saldo],
                        backgroundColor: [
                            '#b39ddb',
                            '#7e57c2',
                            '#d1c4e9'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // =============================================
        // Funcionalidades de Férias
        // =============================================
        function solicitarFerias(e) {
            e.preventDefault();
            const inicio = document.getElementById('ferias-inicio').value;
            const fim = document.getElementById('ferias-fim').value;
            const obs = document.getElementById('ferias-obs').value;

            const novaFerias = new Ferias(
                database.ferias.length + 1,
                currentUser.id,
                inicio,
                fim,
                obs
            );

            database.ferias.push(novaFerias);
            saveDatabase(database);
            feriasForm.reset();
            loadFerias();
            
            showNotification('Férias Solicitadas', 'Sua solicitação de férias foi enviada com sucesso!');
        }

        function loadFerias() {
            const userFerias = database.ferias.filter(f => f.userId === currentUser.id);
            feriasItems.innerHTML = '';

            if (userFerias.length === 0) {
                feriasItems.innerHTML = '<p class="text-gray-500">Nenhuma solicitação de férias encontrada.</p>';
                return;
            }

            userFerias.forEach(f => {
                const item = document.createElement('div');
                item.className = 'card p-4';
                item.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold">${new Date(f.inicio).toLocaleDateString()} - ${new Date(f.fim).toLocaleDateString()}</p>
                            <p class="text-sm text-gray-600">Solicitado em: ${new Date(f.dataSolicitacao).toLocaleString()}</p>
                            ${f.observacoes ? `<p class="mt-2 text-sm">${f.observacoes}</p>` : ''}
                        </div>
                        <span class="px-2 py-1 rounded text-xs ${
                            f.status === 'aprovado' ? 'bg-green-100 text-green-800' :
                            f.status === 'recusado' ? 'bg-red-100 text-red-800' :
                            'bg-yellow-100 text-yellow-800'
                        }">
                            ${f.status}
                        </span>
                    </div>
                `;
                feriasItems.appendChild(item);
            });
        }

        // =============================================
        // Relatórios e PDF
        // =============================================
        function gerarRelatorio() {
            const inicio = document.getElementById('relatorio-inicio').value;
            const fim = document.getElementById('relatorio-fim').value;

            if (!inicio || !fim) {
                showNotification('Erro', 'Selecione o período para gerar o relatório');
                return;
            }

            const userPontos = database.pontos.filter(p => 
                p.userId === currentUser.id && 
                new Date(p.data) >= new Date(inicio) && 
                new Date(p.data) <= new Date(fim)
            );

            let horasTrabalhadas = 0;
            let horasExtras = 0;
            let entradas = 0;
            let saidas = 0;
            let intervalos = 0;

            // Calcular totais
            userPontos.forEach(ponto => {
                if (ponto.tipo === 'entrada') entradas++;
                if (ponto.tipo === 'saida') saidas++;
                if (ponto.tipo === 'intervalo') intervalos++;
            });

            // Simulação de cálculo (em um sistema real, seria mais preciso)
            const diasTrabalhados = Math.min(entradas, saidas);
            horasTrabalhadas = diasTrabalhados * 8;
            horasExtras = Math.max(0, (diasTrabalhados * 8) - 44); // 44h semanais

            relatorioResumo.innerHTML = `
                <p><strong>Período:</strong> ${new Date(inicio).toLocaleDateString()} - ${new Date(fim).toLocaleDateString()}</p>
                <p><strong>Total de registros:</strong> ${userPontos.length}</p>
                <p><strong>Dias trabalhados:</strong> ${diasTrabalhados}</p>
                <p><strong>Horas trabalhadas:</strong> ${horasTrabalhadas}h</p>
                <p><strong>Horas extras:</strong> ${horasExtras}h</p>
                <p><strong>Intervalos:</strong> ${intervalos}</p>
                <p><strong>Faltas:</strong> ${Math.max(0, 22 - diasTrabalhados)}</p>
            `;

            // Gráfico
            const ctx = document.getElementById('relatorio-chart');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Entradas', 'Saídas', 'Intervalos', 'Horas Trabalhadas', 'Horas Extras'],
                    datasets: [{
                        label: 'Resumo',
                        data: [entradas, saidas, intervalos, horasTrabalhadas, horasExtras],
                        backgroundColor: [
                            '#b39ddb',
                            '#7e57c2',
                            '#d1c4e9',
                            '#9575cd',
                            '#673ab7'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            relatorioResultado.classList.remove('hidden');
        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabeçalho
            doc.setFontSize(18);
            doc.setTextColor(115, 79, 194);
            doc.text('Relatório de Ponto - Telecom', 105, 20, null, null, 'center');
            
            // Informações do usuário
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Colaborador: ${currentUser.name}`, 20, 30);
            doc.text(`Período: ${document.getElementById('relatorio-inicio').value} a ${document.getElementById('relatorio-fim').value}`, 20, 40);
            
            // Dados do relatório
            const lines = relatorioResumo.textContent.split('\n').filter(l => l.trim());
            let y = 60;
            
            lines.forEach(line => {
                doc.text(line.trim(), 20, y);
                y += 7;
            });
            
            // Adicionar gráfico (simplificado)
            y += 10;
            doc.text('Resumo Gráfico:', 20, y);
            y += 10;
            
            // Simular gráfico com retângulos
            const data = [25, 40, 15]; // Valores fictícios
            let x = 20;
            data.forEach((value, index) => {
                doc.setFillColor(115 + (index * 40), 79, 194);
                doc.rect(x, y, 20, -value / 2, 'F');
                x += 25;
            });
            
            // Rodapé
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleString()}`, 20, 280);
            
            doc.save(`relatorio_ponto_${currentUser.name}_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // =============================================
        // Reconhecimento Facial (simulado com TensorFlow.js)
        // =============================================
        async function initFaceRecognition() {
            try {
                // Simular carregamento de modelo
                faceRecognitionStatus.textContent = 'Carregando modelo de reconhecimento...';
                
                // Em produção, usar um modelo real como Face-API.js ou TensorFlow.js
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                faceRecognitionStatus.textContent = 'Modelo carregado. Clique em "Iniciar Reconhecimento"';
                startFaceRecognitionBtn.disabled = false;
            } catch (error) {
                faceRecognitionStatus.textContent = `Erro ao carregar modelo: ${error.message}`;
            }
        }

        function startFaceRecognition() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                faceRecognitionStatus.textContent = 'Aguardando reconhecimento facial...';
                
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        videoElement.srcObject = stream;
                        videoElement.play();
                        
                        // Simular reconhecimento após 3 segundos
                        setTimeout(() => {
                            const context = canvasElement.getContext('2d');
                            canvasElement.width = videoElement.videoWidth;
                            canvasElement.height = videoElement.videoHeight;
                            context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
                            
                            // Simular reconhecimento bem-sucedido
                            faceRecognitionStatus.innerHTML = '<span class="text-green-500">Reconhecimento bem-sucedido!</span>';
                            
                            // Registrar ponto automaticamente
                            const novoPonto = new Ponto(
                                database.pontos.length + 1,
                                currentUser.id,
                                'entrada',
                                new Date().toISOString(),
                                { lat: 0, lng: 0 },
                                'reconhecimento_facial'
                            );
                            
                            database.pontos.push(novoPonto);
                            saveDatabase(database);
                            
                            showNotification('Ponto Registrado', 'Ponto registrado via reconhecimento facial!');
                            
                            // Parar a câmera
                            stream.getTracks().forEach(track => track.stop());
                        }, 3000);
                    })
                    .catch(function(error) {
                        faceRecognitionStatus.textContent = `Erro ao acessar câmera: ${error.message}`;
                    });
            } else {
                faceRecognitionStatus.textContent = 'Acesso à câmera não suportado';
            }
        }

        // =============================================
        // Painel Administrativo
        // =============================================
        function loadAdminData() {
            // Pontos recentes
            const pontosRecentes = database.pontos.slice(-5).reverse();
            const pontosContainer = document.getElementById('admin-pontos-recentes');
            pontosContainer.innerHTML = '';
            
            if (pontosRecentes.length === 0) {
                pontosContainer.innerHTML = '<p class="text-gray-500">Nenhum ponto registrado recentemente</p>';
            } else {
                pontosRecentes.forEach(ponto => {
                    const user = database.users.find(u => u.id === ponto.userId);
                    const item = document.createElement('div');
                    item.className = 'card p-3';
                    item.innerHTML = `
                        <p class="font-semibold">${user ? user.name : 'Usuário desconhecido'}</p>
                        <p class="text-sm">${formatDate(ponto.data)} - ${ponto.tipo}</p>
                        <p class="text-xs text-gray-600">Método: ${ponto.metodo}</p>
                    `;
                    pontosContainer.appendChild(item);
                });
            }
            
            // Férias pendentes
            const feriasPendentes = database.ferias.filter(f => f.status === 'pendente');
            const feriasContainer = document.getElementById('admin-ferias-pendentes');
            feriasContainer.innerHTML = '';
            
            if (feriasPendentes.length === 0) {
                feriasContainer.innerHTML = '<p class="text-gray-500">Nenhuma solicitação de férias pendente</p>';
            } else {
                feriasPendentes.forEach(ferias => {
                    const user = database.users.find(u => u.id === ferias.userId);
                    const item = document.createElement('div');
                    item.className = 'card p-4';
                    item.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold">${user ? user.name : 'Usuário desconhecido'}</p>
                                <p class="text-sm">${new Date(ferias.inicio).toLocaleDateString()} - ${new Date(ferias.fim).toLocaleDateString()}</p>
                                ${ferias.observacoes ? `<p class="mt-1 text-sm">${ferias.observacoes}</p>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="aprovarFerias(${ferias.id})" class="px-2 py-1 bg-green-500 text-white rounded text-xs">Aprovar</button>
                                <button onclick="reprovarFerias(${ferias.id})" class="px-2 py-1 bg-red-500 text-white rounded text-xs">Reprovar</button>
                            </div>
                        </div>
                    `;
                    feriasContainer.appendChild(item);
                });
            }
        }

        // Funções globais para os botões de aprovação
        window.aprovarFerias = function(id) {
            const ferias = database.ferias.find(f => f.id === id);
            if (ferias) {
                ferias.status = 'aprovado';
                saveDatabase(database);
                loadAdminData();
                showNotification('Férias Aprovadas', 'A solicitação de férias foi aprovada com sucesso.');
            }
        };

        window.reprovarFerias = function(id) {
            const ferias = database.ferias.find(f => f.id === id);
            if (ferias) {
                ferias.status = 'recusado';
                saveDatabase(database);
                loadAdminData();
                showNotification('Férias Reprovadas', 'A solicitação de férias foi reprovada.');
            }
        };

        // =============================================
        // Event Listeners e Inicialização
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Carregar banco de dados
            database = loadDatabase();
            
            // Inicializar calendário
            initCalendar();
            
            // Inicializar reconhecimento facial
            initFaceRecognition();
            
            // Event Listeners
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                const user = database.users.find(u => u.email === email && u.password === password);
                if (user) {
                    currentUser = user;
                    currentToken = generateToken(user);
                    
                    loginPage.classList.add('hidden');
                    dashboard.classList.remove('hidden');
                    loginBtn.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                    
                    if (user.role === 'admin') {
                        adminBtn.classList.remove('hidden');
                    }
                    
                    showSection('registrar');
                } else {
                    showNotification('Erro de Login', 'Credenciais inválidas');
                }
            });
            
            logoutBtn.addEventListener('click', function() {
                currentUser = null;
                currentToken = null;
                
                dashboard.classList.add('hidden');
                loginPage.classList.remove('hidden');
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
            });
            
            registrarBtn.addEventListener('click', () => showSection('registrar'));
            calendarioBtn.addEventListener('click', () => showSection('calendario'));
            feriasBtn.addEventListener('click', () => showSection('ferias'));
            relatoriosBtn.addEventListener('click', () => showSection('relatorios'));
            adminBtn.addEventListener('click', () => showSection('admin'));
            
            registrarPontoBtn.addEventListener('click', registrarPonto);
            feriasForm.addEventListener('submit', solicitarFerias);
            gerarRelatorioBtn.addEventListener('click', gerarRelatorio);
            exportarPdfBtn.addEventListener('click', exportarPDF);
            startFaceRecognitionBtn.addEventListener('click', startFaceRecognition);
            notificationClose.addEventListener('click', () => notificationModal.classList.add('hidden'));
        });
    </script>
</body>
</html>
```

